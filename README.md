# 无限制本地纯前端AI智能体对话项目

这是一个基于Vue 3的纯前端AI对话应用，支持创建多个具有不同角色设定的AI智能体，进行本地或网络API驱动的对话，并具备一些高级功能如Stable Diffusion图像生成、对话历史管理、音乐播放、样式定制等。

## 项目概述

本项目提供了一个基于浏览器的AI对话界面，具备以下核心功能：

- **AI智能体管理**: 创建、编辑、删除具有不同角色设定的AI智能体
- **AI酒馆系统**: 全新的多角色AI对话场景，支持角色协调发言、自动对话、智能记忆
- **多智能体对话**: 每个智能体拥有独立的对话历史
- **多API支持**: 支持OpenAI、DeepSeek、Anthropic、Azure、Google Gemini、硅基流动及本地模型
- 支持为不同服务商分别配置 API Key，切换服务商时自动保存和加载
- 支持智能体级别的单独 API 配置，优先于全局设置
- **图像生成**: 集成Stable Diffusion，支持基于对话内容的图像生成
- **音乐播放器**: 集成网易云音乐API，支持音乐搜索和播放功能
- **悬浮球工具**: 快速访问常用功能的悬浮球组件
- **个性化定制**: 亮/暗主题、样式定制、动画效果等
- **数据管理**: 支持数据导入导出、自动清理等功能

## 技术栈

- **前端框架**: Vue 3 (Composition API)
- **构建工具**: Vite 5.0.0
- **UI**: 原生CSS + SVG 图标
- **状态管理**: 原生JavaScript类
- **本地存储**: IndexedDB + localStorage（自动降级）
- **项目类型**: ES Module (type: "module")
- **依赖管理**: npm

## 安装与运行

### 环境要求

- Node.js 16+ 
- npm

### 安装依赖

```bash
npm install
```

### 开发模式运行

```bash
npm run dev
```

应用将在 `http://localhost:3000` 启动。

### 构建生产版本

```bash
npm run build
```

构建后的文件将输出到 `dist` 目录。

### 预览生产构建

```bash
npm run preview
```

## 功能特性

### AI智能体管理
- 创建/编辑智能体（名称、头像、场景描述、角色设定等）
- 智能体列表展示与管理
- AI辅助填写功能
- 右键菜单快速操作
- 拖拽排序功能
- 侧边栏收起/展开
- **智能体头像功能**：
  - 支持三种头像类型：表情符号、自定义文字、URL图片
  - **表情符号头像**：从内置表情网格中选择或输入自定义表情
  - **自定义文字头像**：支持1-2个字符的个性化文字头像
  - **URL图片头像**：通过图片URL链接设置头像，支持实时预览和加载状态显示
  - 自动URL验证，支持带查询参数的图片链接
  - 头像数据随智能体数据一起导入导出
- **智能体记忆功能**：
  - 为每个智能体添加长期记忆内容
  - 记忆内容会在每次对话开始时自动作为上下文提供给AI
  - 支持手动编辑记忆内容
  - 支持AI自动总结对话并生成记忆
  - 记忆状态实时显示
  - 记忆内容随智能体数据一起导入导出
- **智能体技能系统**：
  - 为智能体配置特殊技能，扩展对话能力
  - 支持8种技能：长文写作、真人对话、文件上传、代码编写、网络搜索、图像生成、数据分析、多语言翻译
  - 技能按分类组织：内容创作、对话能力、工具能力、技术能力、创意能力
  - 技能之间独立运行，互不干扰，可同时启用多个技能
  - 根据启用的技能动态显示对应的UI组件
  - 技能数据随智能体数据一起导入导出

### AI酒馆对话系统
- **多角色场景**：创建和管理多个AI角色，支持角色间自主对话
- **角色设定系统**：
  - 名称、头像、角色、人设、关注领域、互动习惯
  - 优先级设置：控制角色发言的优先级
  - 限制条件：设置角色的出现条件（如时间、地点等）
  - 角色记忆：每个角色独立的长期记忆
  - 角色管理：创建、编辑、删除角色，支持拖拽排序
- **三层记忆架构**：
  - 角色记忆：每个角色独立的长期记忆
  - 全局记忆：场景级别的共享记忆
  - 世界事件：记录重要事件，影响角色行为
- **智能发言判定**：
  - 批量判断角色是否应该发言
  - 检查角色限制条件与全局记忆是否冲突
  - 自动过滤不应该发言的角色
- **冲突解决机制**：
  - AI协调多个角色的发言顺序
  - 避免七嘴八舌现象
  - 单角色发言时跳过协调步骤
- **内容自动调整**：
  - 根据发言顺序微调对话内容
  - 检查冗余、上下文缺失、话题漂移等
  - 提升对话连贯性和质量
- **自动对话模式**：
  - 角色自主互动，无需用户干预
  - AI自动判断是否继续对话
  - 智能间隔时间（1-10秒）
  - 最大15轮对话限制
- **输入提示系统**：
  - @角色提示：输入@后显示所有可用角色
  - /命令提示：输入/后显示系统命令
  - 键盘导航：上下键选择，回车确认，ESC关闭
  - 鼠标交互：点击提示项直接插入
- **系统命令**：
  - `/打断`：停止当前自动对话
  - `/修改记忆`：修改角色或全局记忆
  - `/结束会话`：结束当前对话会话
- **强制命令**：`@角色名 强制 命令`强制角色执行特定指令
- **实时状态反馈**：显示AI分析、协调、发言等不同阶段的操作状态
- **对话历史持久化**：使用IndexedDB存储对话记录
- **侧边栏管理**：角色列表、记忆管理、事件记录等完整功能
- **右键菜单**：支持角色快速操作（编辑、删除、添加记忆等）
- **消息气泡样式**：区分用户消息、角色消息、系统通知等不同类型
- **流式输出**：角色回复采用流式输出，提供更自然的对话体验
- **用户发送消息后立即清除输入框内容**：无需等待角色回复

### 对话系统
- 多智能体独立对话历史
- 流式输出模式
- **AI辅助功能**：
  - 推荐回复：AI生成4个不同的回复建议
  - 翻译：支持8种语言的智能翻译（中英互译、日韩法德西俄）
  - 扩写：对文本进行详细扩写，增加更多细节和解释
  - 优化：优化文本表达，使其更加清晰、准确和有说服力
  - 一键应用：AI处理结果自动填入输入框
- 消息编辑与复制
- 令牌数与思考时间显示
- 重新生成功能
- 智能滚动
- 智能体记忆自动注入，提供上下文信息
- 对话总结功能，自动生成记忆内容
- **文件上传功能**：
  - 支持多文件上传，一次可选择多个文件
  - 已上传文件显示在输入区域上方，以卡片形式展示
  - 每个文件显示图标、名称、大小和删除按钮
  - 支持删除已上传的文件
  - 发送消息时自动将所有文件内容添加到消息中
  - 发送后自动清空已上传文件列表
- **网络搜索功能**：
  - 提供自动网络搜索工具，无需用户手动执行搜索
  - 点击网络搜索按钮，输入搜索关键词
  - 系统自动执行搜索并抓取内容
  - 搜索结果格式化后自动添加到输入框中
  - 搜索结果包含标题、内容、链接
  - 如果后端API不可用，提供模拟搜索结果用于测试
- **右键菜单功能**：
  - 聊天区域右键：清理对话记录、导出智能体、多选对话
  - 消息气泡右键：复制、重新生成（AI消息）、删除、导出对话、多选对话
  - 智能定位：自动调整菜单位置避免超出屏幕边界
  - 点击外部自动关闭
- **多选对话功能**：
  - 批量选择多条消息进行操作
  - 支持全选和清空选择
  - 批量操作：复制、导出、删除
  - 实时显示已选择的消息数量
  - 优雅的卡片式选择界面
- **导出对话功能**：
  - 支持5种导出格式：Markdown、HTML、PDF、JSON、图片
  - 实时预览导出内容
  - 主题适配：自动适配用户设置的亮/暗主题
  - 完整的Markdown样式支持（代码块、表格、链接等）
  - HTML导出：完整的CSS样式，与聊天界面一致
  - PDF导出：使用浏览器打印功能生成PDF
  - 图片导出：使用html2canvas生成高质量PNG图片
  - 统一的样式和布局，所有格式保持一致

### 图像生成
- 集成Stable Diffusion WebUI
- 基于对话内容的AI提示词生成
- 图像生成与展示
- 参数配置（采样步数、CFG Scale、尺寸等）
- 模型选择
- 生成进度显示

### 音乐播放器
- 集成网易云音乐API
- 支持音乐搜索（歌曲、歌手、专辑、歌单等）
- 播放列表管理与拖拽排序
- 播放控制（播放/暂停、上一首、下一首、音量控制）
- 播放进度控制与拖动定位
- 歌曲信息显示（专辑封面、歌手、专辑名等）
- 多种播放模式（顺序、随机、单曲循环）
- 用户登录功能（二维码、手机验证码）
- 歌单详情与歌手详情查看
- 智能颜色提取：从音乐封面自动提取主题色
- 最小化播放器：可拖拽的悬浮窗模式
- 播放列表自动导航到当前播放歌曲
- **沉浸式播放器**：
  - 全屏沉浸式音乐播放界面，左侧显示专辑封面和歌曲信息
  - 右侧显示滚动歌词，支持Apple Music风格的歌词展示
  - 动态Canvas背景，从专辑封面提取颜色并创建自然混合效果
  - 支持歌词显示/隐藏翻译，译文与原歌词时间精确对齐
  - 歌词行高度自适应，有译文时自动增加行高
  - 点击歌词可直接跳转到对应时间点
  - 非活跃歌词行模糊效果，突出当前播放歌词
  - 快-慢曲线动画，提供流畅的滚动体验
- **右键菜单功能**：
  - 用户歌单右键菜单：编辑歌单、删除歌单
  - 所有歌曲右键菜单：收藏歌曲、添加到播放列表、添加到指定歌单
  - 支持在子菜单中直接选择歌单添加歌曲，无需打开额外弹窗
  - 覆盖所有歌曲显示区域：主页推荐、搜索结果、歌手详情、歌单详情、专辑详情
  - 智能定位：自动调整菜单位置避免超出视窗边界
- **音乐收藏功能**：
  - 收藏/取消收藏歌曲，支持一键收藏操作
  - 收藏状态实时同步，心形图标动态显示
  - 搜索结果中直接收藏，无需打开播放页面
  - 用户登录后自动加载个人收藏列表
- **歌单管理功能**：
  - 创建、编辑、删除个人歌单
  - 收藏/取消收藏他人歌单
  - 歌单信息自定义（名称、描述）
  - 权限控制：仅创建者可编辑和删除自己的歌单
  - 优雅的弹窗式操作界面
- **音乐主页**：个性化推荐内容展示
  - 推荐歌单与推荐歌曲展示
  - 用户歌单快速访问
  - 底部迷你播放控件，支持基础播放控制和进度显示
  - 歌手信息点击跳转详情页面
  - 短期缓存机制（5分钟），保证推荐内容时效性
- **右键菜单功能**：
  - 用户歌单右键菜单：支持编辑歌单、删除歌单操作
  - 歌曲右键菜单：支持收藏/取消收藏、添加到播放列表
  - 添加到歌单功能：通过子菜单直接选择目标歌单，无需打开额外弹窗
  - 支持所有歌曲区域的右键操作：主页推荐、搜索结果、歌手/歌单/专辑详情
  - 自动定位调整，确保菜单不超出视窗边界

### 悬浮球工具
- 可拖拽的悬浮球界面
- 快速访问音乐播放器、草稿纸、快速对话等功能
- 移动端优化的触摸交互
- 自定义位置记忆
- 快速切换智能体功能
- 右键菜单快速访问智能体记忆和管理功能

### 样式与主题
- 亮/暗主题切换
- 样式定制（主色调、字体大小、圆角等）
- 多种动画效果与动画演示
- 多种消息气泡样式与聊天布局
- 颜色模式选择
- 流光效果（可调节透明度和速度）
- 灵动岛设计
- 弹窗背景模糊和暗化效果
- 字体检测与自定义字体选择
- 音乐封面颜色自适应主题
- 侧边栏按钮网格布局（2x2）

### 数据管理
- 数据导入导出功能
- 自动清理机制
- 手动清理功能
- 存储优化

## 配置说明

### AI API配置
在应用中配置所需的AI服务API密钥和端点。

**多服务商 API Key 管理**：
- 支持为不同服务商（OpenAI、DeepSeek、Anthropic、Azure、Google Gemini、硅基流动）分别保存 API Key
- 切换服务商时自动保存并加载对应的 API Key
- 支持智能体级别的 API 配置，可为特定智能体单独设置服务商和密钥
- 智能体设置优先于全局设置，灵活配置不同智能体使用不同的 API

**智能体单独 API 设置**：
- 在智能体创建/编辑界面中勾选"单独设置API"
- 为该智能体单独配置 API 服务商、密钥和模型
- 不使用全局设置，实现智能体级别的 API 隔离
- 支持自定义模型名称，灵活适配各种模型

**模型选择**：
- 每个服务商提供推荐的模型列表（带 ⭐ 标记）
- 选择"自定义"可手动输入任意模型名称
- 硅基流动支持 107 个 LLM 模型，包括 Qwen、DeepSeek、GLM、ERNIE、Kimi 等系列

**多服务商 API Key 管理**：
- 支持为不同服务商（OpenAI、DeepSeek、Anthropic、Azure、Google Gemini、硅基流动）分别保存 API Key
- 切换服务商时自动保存当前 API Key 并加载对应的密钥
- 支持自定义端点配置，兼容各种 API 服务

**智能体单独 API 设置**：
- 支持为特定智能体单独配置 API 提供商和密钥
- 勾选"单独设置API"后可配置：
  - API 服务商选择
  - 模型名称选择（支持 70+ 模型）
  - 自定义模型名称
  - API 密钥配置
- 智能体级别的设置优先于全局设置
- 未配置的字段自动使用全局设置

### Stable Diffusion配置
本地运行Stable Diffusion WebUI，应用将通过代理访问 `http://127.0.0.1:7860`。

### 音乐API配置
1. 需要运行网易云音乐API后端服务
2. 在应用设置中配置音乐API服务器地址
3. 默认使用 `https://zm.i9mr.com` 作为API端点

## 文件结构

```
.
├── index.html              # 应用入口HTML文件
├── package.json            # 项目配置和依赖
├── package-lock.json       # 锁定依赖版本
├── vite.config.js          # Vite构建配置
├── README.md              # 项目说明文档
├── IFLOW.md               # 项目开发指南文档
├── api.md                 # 网易云音乐API文档
├── dist/                  # 构建输出目录
├── node_modules/          # 依赖模块目录
├── public/                # 静态资源
│   └── favicon.ico
└── src/                   # 源代码目录
    ├── main.js            # Vue应用入口
    ├── App.vue            # 主应用组件
    ├── storage.js         # 本地存储管理模块
    ├── indexedDB.js       # IndexedDB 数据库管理模块
    ├── aiService.js       # AI模型服务兼容层
    ├── tavernDB.js        # 酒馆系统IndexedDB管理模块
    ├── tavernAIService.js # 酒馆AI服务层
    ├── components/        # 可复用组件
    │   ├── AgentMemory.vue         # 智能体记忆管理组件
    │   ├── AnimationDemo.vue      # 动画效果演示组件
    │   ├── AvatarUpload.vue       # 头像上传组件
    │   ├── CustomCheckbox.vue     # 自定义复选框组件
    │   ├── CustomSelect.vue       # 自定义下拉选择组件
    │   ├── CustomSlider.vue       # 自定义滑块组件
    │   ├── CustomDropdown.vue     # 自定义下拉选择组件
    │   ├── FloatingBall.vue       # 浮动球组件
    │   ├── Modal.vue              # 模态框组件
    │   ├── MusicLogin.vue         # 网易云音乐登录组件
    │   ├── MusicPlayer.vue        # 音乐播放器组件
    │   ├── StyleSettings.vue      # 样式设置组件
    │   ├── Tavern.vue             # 酒馆主组件
    │   ├── TavernChat.vue         # 酒馆对话组件
    │   └── TavernSidebar.vue      # 酒馆侧边栏组件
    ├── styles/            # CSS样式文件
    │   ├── animations.css
    │   ├── base.css
    │   ├── components.css
    │   ├── global.css
    │   └── variables.css
    └── utils/             # 工具类
        ├── fontDetector.js        # 字体检测工具
        ├── markdownParser.js      # Markdown解析器
        ├── musicApiRequestManager.js # 音乐API请求管理工具
        ├── musicColorExtractor.js # 音乐封面颜色提取工具
        ├── skills.js              # 智能体技能定义
        ├── skillService.js        # 技能服务层
        └── theme.js               # 主题管理工具
```

## 开发约定

- 使用Vue 3 Composition API风格
- CSS类名使用BEM命名约定
- JavaScript使用ES6+特性
- 组件和文件命名使用PascalCase或kebab-case
- 严格遵循Vue 3最佳实践
- 使用 IndexedDB + localStorage 进行数据持久化（自动降级）
- 所有异步操作使用 async/await 模式
- 确保代码在各种浏览器环境中的兼容性

## 最新更新

### v3.5.0 API 管理系统全面升级
- 🔑 **多服务商 API Key 管理**：
  - 支持为不同服务商（OpenAI、DeepSeek、Anthropic、Azure、Google Gemini、硅基流动）分别保存 API Key
  - 切换服务商时自动保存当前 API Key 并加载对应的密钥
  - 智能的 API Key 管理，无需重复输入
  - 支持 6 个主流服务商的独立配置
- 🤖 **智能体单独 API 设置**：
  - 新增"单独设置API"功能，支持为特定智能体配置独立的 API
  - 智能体级别的 API 设置优先于全局设置
  - 支持配置 API 服务商、密钥和模型名称
  - 未配置的字段自动使用全局设置，确保兼容性
- 📋 **模型选择系统**：
  - 每个服务商提供推荐的模型列表（带 ⭐ 标记）
  - 硅基流动支持 107 个 LLM 模型，包括 Qwen、DeepSeek、GLM、ERNIE、Kimi 等系列
  - 支持 6 个推荐模型，便于快速选择
  - 选择"自定义"可手动输入任意模型名称
- 🎯 **服务商自动配置**：
  - 切换服务商时自动设置默认 API 端点
  - 支持自定义端点配置，兼容各种 API 服务
  - 硅基流动默认端点：https://api.siliconflow.cn/v1/chat/completions
- 🔧 **技术优化**：
  - 优化 AI 服务合并设置逻辑，智能体设置优先于全局设置
  - 添加服务商特定的 max_tokens 限制，避免 API 错误
  - DeepSeek: 8192, Anthropic: 4096, OpenAI: 4096, Azure: 4096, Google: 8192
  - 修复密码输入框的浏览器警告，移除不必要的 autocomplete 属性
  - 使用项目统一的 CustomCheckbox 组件，保持设计一致性

### v3.4.0 AI服务增强与界面优化
- 🤖 **AI服务增强**：
  - 新增硅基流动 API 提供商，支持 107 个 LLM 模型
  - 推荐模型标记：6 个推荐模型带 ⭐ 标记，便于快速选择
  - 自定义模型名称：支持手动输入任意模型名称
  - 思考模型支持：完美支持 DeepSeek-R1 等思考模型的 reasoning_content 字段
  - 思考内容样式优化：透明度降低，与普通内容区分更加明显
  - 特殊标记系统：使用 __REASONING_START__ 和 __REASONING_END__ 分隔思考内容
  - 多段思考内容支持：正确解析包含多段内容的思考输出
- 🎨 **界面优化**：
  - 完全重写 sidebar 样式和布局，更符合项目整体风格
  - 适配主题颜色和组件颜色变量，保证可读性
  - 避免过度泛光效果，贴合页面风格
  - 优化全局按钮网格样式，添加圆角和流畅的 hover 效果
  - 修复 agent-actions 垂直对齐问题，按钮完美居中
  - 修复收起状态下创建按钮过高的问题
  - 优化 flexbox 布局，提升响应式体验
- 🔧 **技术优化**：
  - 扩展 AI API 提供商配置，支持更多模型和服务
  - 优化响应解析逻辑，支持多种响应格式
  - 改进内容格式化，支持思考内容和普通内容分离显示
  - 添加推荐模型标记系统，提升用户体验

### v3.3.0 智能体技能系统全新上线
- 🎯 **智能体技能系统**：
  - 全新的智能体技能配置系统，支持为智能体添加特殊能力
  - 8种技能可选：长文写作、真人对话、文件上传、代码编写、网络搜索、图像生成、数据分析、多语言翻译
  - 技能按分类组织：内容创作、对话能力、工具能力、技术能力、创意能力
  - 简洁的技能选择界面，按分类展示，支持多选
  - 技能之间独立运行，互不干扰，可同时启用多个技能
  - 技能数据随智能体数据一起导入导出
- 📁 **文件上传功能优化**：
  - 支持多文件上传，一次可选择多个文件
  - 已上传文件显示在输入区域上方，以卡片形式展示
  - 每个文件显示图标、名称、大小和删除按钮
  - 支持删除已上传的文件
  - 发送消息时自动将所有文件内容添加到消息中
  - 发送后自动清空已上传文件列表
- 🔍 **网络搜索功能优化**：
  - 提供自动网络搜索工具，无需用户手动执行搜索
  - 点击网络搜索按钮，输入搜索关键词
  - 系统自动执行搜索并抓取内容
  - 搜索结果格式化后自动添加到输入框中
  - 搜索结果包含标题、内容、链接
  - 如果后端API不可用，提供模拟搜索结果用于测试
- 🎨 **界面优化**：
  - 技能选择界面采用简洁的网格布局
  - 技能卡片设计，悬停效果明显
  - 选中状态清晰，带勾选标记
  - 自定义滚动条样式，与项目风格一致
  - 完全适配暗色主题
- 🔧 **技术优化**：
  - 新增skills.js：智能体技能定义文件
  - 新增skillService.js：技能服务层，处理技能逻辑
  - 优化文件上传逻辑，支持多文件管理
  - 优化网络搜索逻辑，自动抓取内容
  - 技能与UI组件动态绑定，按需显示

### v3.2.0 对话交互功能全面升级
- 🤖 **AI辅助功能**：
  - 新增AI辅助按钮，整合多种AI辅助操作
  - 推荐回复：AI智能生成4个不同的回复建议
  - 翻译功能：支持8种语言的智能翻译（中文、英文、日语、韩语、法语、德语、西班牙语、俄语）
  - 扩写功能：对文本进行详细扩写，增加更多细节和解释
  - 优化功能：优化文本表达，使其更加清晰、准确和有说服力
  - 一键应用：AI处理结果自动填入输入框
  - 优雅的菜单界面，向上展开，点击外部自动关闭
- 🖱️ **右键菜单系统**：
  - 聊天区域右键：清理对话记录、导出智能体、多选对话
  - 消息气泡右键：复制、重新生成（AI消息）、删除、导出对话、多选对话
  - 智能定位：自动调整菜单位置避免超出屏幕边界
  - 点击外部自动关闭，提升用户体验
  - 简洁的卡片式设计，带SVG图标
- ✅ **多选对话功能**：
  - 批量选择多条消息进行操作
  - 支持全选和清空选择功能
  - 批量操作：复制、导出、删除
  - 实时显示已选择的消息数量
  - 优雅的卡片式选择界面，带勾选框
  - 消息预览：显示角色、内容预览和时间戳
- 📤 **导出对话功能**：
  - 支持5种导出格式：Markdown、HTML、PDF、JSON、图片
  - 实时预览导出内容
  - 主题适配：自动适配用户设置的亮/暗主题
  - 完整的Markdown样式支持（代码块、表格、链接、列表等）
  - HTML导出：完整的CSS样式，与聊天界面完全一致
  - PDF导出：使用浏览器打印功能生成PDF
  - 图片导出：使用html2canvas生成高质量PNG图片（2倍缩放）
  - 统一的样式和布局，所有格式保持一致
  - 支持单条消息导出和批量导出
- 🎨 **界面优化**：
  - AI辅助菜单使用简洁的卡片式设计
  - 推荐回复弹窗优化：更大的加载动画、更流畅的过渡效果
  - 翻译弹窗优化：网格布局的语言选择、国旗emoji图标
  - 多选弹窗优化：卡片式消息列表、左侧彩色指示条
  - 所有弹窗使用统一的现代化设计语言
- 🔧 **技术优化**：
  - 新增 `generateExportStyles()` 方法，生成统一的导出样式
  - 优化事件冒泡处理，确保右键菜单正确识别消息
  - 安装 html2canvas 库，实现真正的图片导出功能
  - 修复导出功能的样式问题，确保与聊天界面一致
  - 优化多选消息导出逻辑，正确处理选中的消息

### v3.1.0 AI生成功能全新上线
- 🤖 **世界设定AI生成**：
  - AI自动生成完整的世界设定，包括世界观、物理法则、社会体系等
  - 智能优化现有设定，补充细节和深化世界观
  - 支持用户输入基本设定或预期设定作为参考
  - 一键生成/优化，节省创作时间
- 👤 **角色信息AI生成/优化**：
  - 根据已有信息智能补充和优化角色设定
  - 自动生成角色名称、身份、人设、语言风格、行为准则等
  - 支持用户输入角色基本信息作为参考
  - 智能保留已有信息，只补充缺失内容
- 🎲 **随机角色AI创建**：
  - 从零开始生成符合世界设定的随机角色
  - 完全随机或基于用户输入的基础信息生成
  - 一键添加到角色列表，快速丰富场景
- 🧑 **用户人设AI生成**：
  - 智能生成或优化用户在场景中的身份设定
  - 支持用户输入基本设定作为参考
  - 自动生成用户性格、与角色的关系等信息
- 🎨 **统一的AI生成界面**：
  - 所有AI生成功能采用一致的界面设计
  - 输入框+按钮布局，支持可选的参考信息输入
  - 流光效果和加载状态显示
  - 优雅的虚线分隔和居中布局

### v3.0.0 酒馆系统全新上线
- 🏰 **AI酒馆对话系统**：
  - 全新的多角色AI对话场景，支持创建和管理多个AI角色
  - 角色设定系统：支持名称、头像、角色、人设、关注领域、互动习惯、优先级等详细设定
  - 三层记忆架构：角色记忆、全局记忆、世界事件，确保对话连贯性和上下文完整性
  - 智能发言判定：批量判断角色是否应该发言，避免七嘴八舌现象
  - 冲突解决机制：AI协调多个角色的发言顺序，确保对话逻辑清晰
  - 内容自动调整：根据发言顺序和上下文微调对话内容，提升对话质量
  - **自动对话模式**：角色自主互动，AI自动判断是否继续对话及间隔时间
  - 实时状态反馈：显示AI分析、协调、发言等不同阶段的操作状态
  - **输入提示系统**：支持@角色和/命令的智能提示，提升输入效率
  - 强制命令功能：使用`@角色名 强制 命令`强制角色执行特定指令
  - 系统命令支持：`/打断`、`/修改记忆`、`/结束会话`等命令
  - 场景配置管理：支持场景描述、角色列表、记忆管理等完整配置
  - 对话历史持久化：使用IndexedDB存储对话记录
  - 侧边栏管理：角色列表、记忆管理、事件记录等完整功能
  - 右键菜单：支持角色快速操作（编辑、删除、添加记忆等）
  - 拖拽排序：支持角色列表拖拽排序
- 💬 **对话体验优化**：
  - 用户发送消息后立即清除输入框内容，无需等待角色回复
  - 多角色协调发言，避免同时说话的混乱现象
  - 智能间隔时间：AI根据对话状态自动调整下一轮对话的等待时间（1-10秒）
  - 系统通知：显示场景加载、角色发言等系统消息，3秒后自动消失
  - 消息气泡样式：区分用户消息、角色消息、系统通知等不同类型
  - 流式输出：角色回复采用流式输出，提供更自然的对话体验
- 🧠 **记忆系统增强**：
  - 角色记忆：每个角色独立的长期记忆，在对话开始时自动注入
  - 全局记忆：场景级别的共享记忆，所有角色都能访问
  - 世界事件：记录重要事件，影响角色行为和对话内容
  - 记忆格式兼容：支持对象格式和数组格式的记忆数据
  - 设定冲突检查：自动检查角色限制条件与全局记忆是否冲突
- 🎯 **角色设定系统**：
  - 详细的角色信息：名称、头像、角色、人设、关注领域、互动习惯
  - 优先级设置：控制角色发言的优先级
  - 限制条件：支持设置角色的出现条件（如时间、地点等）
  - 角色头像：支持表情符号、自定义文字、URL图片三种类型
  - 角色记忆：为每个角色添加独立的记忆内容
  - 角色管理：创建、编辑、删除角色，支持拖拽排序
- ⌨️ **输入提示系统**：
  - @角色提示：输入@后显示所有可用角色列表
  - /命令提示：输入/后显示所有系统命令列表
  - 键盘导航：支持上下键选择，回车键确认，ESC键关闭
  - 鼠标交互：点击提示项直接插入
  - 智能定位：提示框自动定位在输入框上方
  - 视觉反馈：选中项高亮显示，hover效果
- 🎨 **界面优化**：
  - 酒馆对话界面：全新的对话场景界面设计
  - 侧边栏：角色列表、记忆管理、事件记录等功能整合
  - 状态显示：实时显示AI操作状态（分析、协调、发言等）
  - 消息气泡：区分不同类型的消息，使用不同样式
  - 系统通知：居中显示的系统消息，3秒后自动消失
  - 响应式设计：支持移动端和桌面端
- 🔧 **技术优化**：
  - 新增tavernDB.js：IndexedDB数据库管理模块
  - 新增tavernAIService.js：AI酒馆服务层，支持批量判断、冲突解决、内容调整
  - 新增Tavern.vue：酒馆主组件
  - 新增TavernChat.vue：酒馆对话组件
  - 新增TavernSidebar.vue：酒馆侧边栏组件
  - 优化AI服务调用：支持批量请求，提升性能
  - 优化记忆注入：自动检查和注入相关记忆
  - 优化冲突解决：单个角色发言时跳过冲突解决步骤

### v2.7.0 新增功能
- 💾 **存储系统全面升级**：
  - 聊天历史和图片数据迁移到 IndexedDB 存储，支持更大的存储空间
  - 实现 localStorage 自动降级机制，确保最大兼容性
  - 当浏览器不支持或 IndexedDB 初始化失败时，自动切换到 localStorage
  - 优化数据清理逻辑，删除智能体时同时清理相关对话和图片数据
  - 支持隐私模式和旧版浏览器环境
- 🎨 **草稿纸工具界面优化**：
  - 重写草稿纸工具界面，采用弱化 header 设计
  - 工具栏更加简洁，与项目整体风格统一
  - 优化按钮、颜色选择器和滑块的样式
  - 更新橡皮擦图标，更加直观
- 🐛 **Bug 修复**：
  - 修复 notification 调用中使用了不存在的 'error' 类型的问题
  - 修复 musicApiRequestManager.js 中 cache 初始化位置错误的问题
  - 修复删除智能体时未清理相关对话记录的问题

### v2.6.0 新增功能
- 🧠 **智能体记忆系统优化**：
  - 修复智能体记忆注入逻辑，确保每次对话都能正确获取记忆上下文
  - 添加详细的调试输出，方便追踪记忆注入过程
  - 优化记忆检查机制，避免重复注入
  - 记忆内容现在会在对话历史为空时自动作为系统消息注入
- 🎨 **界面布局优化**：
  - 将样式设置和 AI 设置按钮从 dynamic-island 移动到 sidebar
  - 侧边栏底部按钮整合为 2x2 网格布局
  - 统一所有按钮样式，视觉更加协调
  - 收起侧边栏时自动隐藏按钮区域
- 🔧 **代码质量提升**：
  - 清理冗余样式定义，使用全局样式
  - 优化按钮组件结构，提升可维护性

### v2.5.0 新增功能
- 🎵 **沉浸式播放器全新体验**：
  - 全屏沉浸式音乐播放界面，左侧专辑封面与右侧歌词的优雅布局
  - 动态Canvas背景系统，从专辑封面智能提取颜色并创建自然混合效果
  - 多层渐变与噪声纹理，实现更加随机和自然的背景视觉效果
  - 背景颜色实时响应音乐变化，打造动态视觉体验
- 🎤 **Apple Music风格歌词系统**：
  - 优雅的滚动歌词展示，支持从下往上的流畅滚动效果
  - 智能歌词解析，保留所有有时间标签的行（包括空行）
  - 歌词译文与原歌词精确时间对齐，支持近似匹配算法
  - 译文显示优化，独立样式设计，不会遮挡原歌词
  - 点击歌词可直接跳转到对应播放时间点
- 🎨 **视觉效果全面升级**：
  - 非活跃歌词行模糊效果，突出当前播放歌词
  - 快-慢曲线动画（cubic-bezier），提供流畅的滚动体验
  - 歌词行高度自适应，有译文时自动增加行高
  - 活跃歌词行使用更细字体和更淡阴影，视觉更柔和
  - 歌词行宽度增加，在一行内塞入更多文本内容
- 🔧 **交互体验优化**：
  - 歌词控制按钮位置优化，更贴近歌曲信息
  - 空行特殊样式，使用音乐符号和斜体显示
  - 近似匹配译文视觉标识，左边框和透明度区分
  - 完整的歌词滚动计算系统，考虑译文高度的动态调整

### v2.4.0 新增功能
- 🖱️ **右键菜单系统全面升级**：
  - 新增用户歌单右键菜单，支持快速编辑和删除操作
  - 实现歌曲全局右键菜单，覆盖所有歌曲显示区域
  - 优化添加到歌单功能，通过子菜单直接选择目标歌单
  - 智能定位系统，自动调整菜单位置避免超出视窗
  - 支持主页推荐、搜索结果、歌手/歌单/专辑详情页面的所有歌曲
  - 点击页面其他位置自动关闭菜单，提升用户体验
- 🎯 **操作流程优化**：
  - 删除添加到歌单弹窗，简化操作步骤
  - 歌单子菜单显示歌曲数量，便于用户快速识别
  - 实时反馈操作结果，成功/失败提示清晰明了
  - 保持数据同步，歌单歌曲数量实时更新
- 🔧 **技术优化**：
  - 修复收藏歌曲Set类型错误，确保数据一致性
  - 优化事件处理机制，防止菜单意外关闭
  - 改进方法命名，提升代码可读性和维护性

### v2.4.0 新增功能
- 🖱️ **右键菜单功能全面升级**：
  - 用户歌单右键菜单：支持编辑歌单、删除歌单操作
  - 所有歌曲右键菜单：收藏/取消收藏歌曲、添加到播放列表
  - 添加到歌单功能：通过子菜单直接选择目标歌单，无需打开额外弹窗
  - 覆盖所有歌曲区域：主页推荐、搜索结果、歌手/歌单/专辑详情、播放列表
  - 智能定位：自动调整菜单位置避免超出视窗边界
  - 点击其他位置自动关闭菜单，提升用户体验
- 🎨 **UI/UX优化**：
  - 右键菜单采用现代化设计，支持暗色主题
  - 子菜单显示歌单封面和歌曲数量，信息展示更直观
  - 添加操作反馈，成功/失败提示信息更清晰
- 🔧 **功能完善**：
  - 修复右键菜单事件冒泡问题
  - 优化菜单显示逻辑，确保菜单始终可见
  - 改进歌曲收藏状态管理，确保数据同步

### v2.3.0 新增功能
- 🎵 **音乐收藏与歌单管理功能**：
  - 新增歌曲收藏功能，支持一键收藏/取消收藏
  - 实现歌单创建、编辑、删除完整管理流程
  - 支持收藏/取消收藏他人歌单
  - 搜索结果中直接收藏歌曲，提升操作效率
  - 收藏状态实时同步，心形图标动态显示
- 🎨 **UI/UX全面优化**：
  - 优化歌单创建/编辑弹窗设计，采用现代化玻璃态效果
  - 改进侧边栏头部样式，增强视觉层次感
  - 修复歌单标题超出容器问题，优化文本显示
  - 简化hover动画，仅保留颜色变化效果
  - 统一设计语言，使用圆角和渐变元素
- 🔧 **交互体验提升**：
  - 优化歌单项布局，确保hover状态下的视觉稳定性
  - 改进按钮反馈效果，增强用户操作感知
  - 完善权限控制，确保用户只能管理自己的歌单
  - 优化加载状态显示，提供更友好的等待体验

### v2.2.0 新增功能
- 🎵 **音乐主页功能全面升级**：
  - 新增个性化推荐内容展示，包括推荐歌单和推荐歌曲
  - 实现底部迷你播放控件，支持基础播放控制和进度显示
  - 推荐歌曲采用紧凑列表设计，优化空间利用
  - 歌手信息支持点击跳转，快速访问歌手详情页面
  - 实现短期缓存机制（5分钟），保证推荐内容时效性
- 🎨 **UI/UX优化**：
  - 优化主页字体颜色显示，提升可读性
  - 改进播放控件时长显示逻辑，确保准确性
  - 底部播放控件支持无歌曲时显示，提供完整体验
- 🔧 **功能完善**：
  - 修复推荐歌曲播放逻辑，与搜索结果保持一致
  - 添加推荐歌曲快速添加到播放列表功能
  - 优化用户信息刷新机制，自动更新主页推荐内容

### v2.1.0 新增功能
- 🎵 **音乐播放器全面升级**：
  - 新增最小化播放器功能，支持可拖拽悬浮窗
  - 添加播放列表自动导航到当前播放歌曲
  - 优化拖拽动画，增加流畅的滞后效果
  - 智能播放列表菜单位置，自适应展开方向
  - 完善播放模式切换与播放列表管理
- 🎨 **样式系统增强**：
  - 新增字体检测工具，支持系统字体选择
  - 音乐封面颜色自动提取与应用
  - 优化加载动画，统一主题颜色
  - 新增动画效果演示组件
- 🔧 **交互体验优化**：
  - 改进tooltip显示位置与动画
  - 修复播放顺序切换按钮功能
  - 优化进度条显示与交互
  - 增强移动端触摸体验

### v2.0.0 核心功能
- 🎵 音乐播放器功能，集成网易云音乐API
- 🎯 悬浮球工具，提供快速访问入口
- 🎨 弹窗背景模糊和暗化效果设置
- 📱 移动端触摸交互体验优化
- 🔧 滑块组件浮点数精度修复
- 💫 流光效果控制，支持透明度调节

## 注意事项

- 项目为纯前端应用，所有数据存储在浏览器中
- 使用网络API需要用户自行配置端点和密钥
- Stable Diffusion图像生成功能需要本地运行SD WebUI
- 音乐播放器功能需要配置并运行网易云音乐API后端服务
- 项目依赖现代浏览器特性，建议使用最新版Chrome/Firefox/Edge
- 图像生成功能依赖SD WebUI的本地部署，需要正确配置代理
- 长对话可能会影响性能，建议适时清理对话历史
- 弹窗背景模糊效果需要浏览器支持 `backdrop-filter` CSS属性

### 数据存储说明

- **对话历史和图片数据**：优先使用 IndexedDB 存储，当浏览器不支持或初始化失败时自动降级到 localStorage
- **智能体信息**：存储在 localStorage 中
- **应用设置**：存储在 localStorage 中
- **智能体记忆**：存储在 localStorage 中
- **数据导入导出**：支持将所有数据导出为 JSON 文件，或从 JSON 文件导入

### 存储兼容性

- IndexedDB 支持更大的存储空间（通常数百MB到数GB），适合存储大量对话和图片数据
- localStorage 存储空间较小（通常5-10MB），在降级模式下建议定期清理对话历史
- 在隐私模式下，IndexedDB 可能不可用，应用会自动使用 localStorage
- 应用会自动检测存储方式并在控制台显示提示信息
