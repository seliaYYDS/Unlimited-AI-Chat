# 无限制本地纯前端AI智能体对话项目

这是一个基于Vue 3的纯前端AI对话应用，支持创建多个具有不同角色设定的AI智能体，进行本地或网络API驱动的对话，并具备一些高级功能如Stable Diffusion图像生成、对话历史管理、音乐播放、样式定制等。

## 项目概述

本项目提供了一个基于浏览器的AI对话界面，具备以下核心功能：

- **AI智能体管理**: 创建、编辑、删除具有不同角色设定的AI智能体
- **多智能体对话**: 每个智能体拥有独立的对话历史
- **多API支持**: 支持OpenAI、DeepSeek、Anthropic、Azure、Google Gemini及本地模型
- **图像生成**: 集成Stable Diffusion，支持基于对话内容的图像生成
- **音乐播放器**: 集成网易云音乐API，支持音乐搜索和播放功能
- **悬浮球工具**: 快速访问常用功能的悬浮球组件
- **个性化定制**: 亮/暗主题、样式定制、动画效果等
- **数据管理**: 支持数据导入导出、自动清理等功能

## 技术栈

- **前端框架**: Vue 3 (Composition API)
- **构建工具**: Vite 5.0.0
- **UI**: 原生CSS + SVG 图标
- **状态管理**: 原生JavaScript类
- **本地存储**: IndexedDB + localStorage（自动降级）
- **项目类型**: ES Module (type: "module")
- **依赖管理**: npm

## 安装与运行

### 环境要求

- Node.js 16+ 
- npm

### 安装依赖

```bash
npm install
```

### 开发模式运行

```bash
npm run dev
```

应用将在 `http://localhost:3000` 启动。

### 构建生产版本

```bash
npm run build
```

构建后的文件将输出到 `dist` 目录。

### 预览生产构建

```bash
npm run preview
```

## 功能特性

### AI智能体管理
- 创建/编辑智能体（名称、头像、场景描述、角色设定等）
- 智能体列表展示与管理
- AI辅助填写功能
- 右键菜单快速操作
- 拖拽排序功能
- 侧边栏收起/展开
- **智能体头像功能**：
  - 支持三种头像类型：表情符号、自定义文字、URL图片
  - **表情符号头像**：从内置表情网格中选择或输入自定义表情
  - **自定义文字头像**：支持1-2个字符的个性化文字头像
  - **URL图片头像**：通过图片URL链接设置头像，支持实时预览和加载状态显示
  - 自动URL验证，支持带查询参数的图片链接
  - 头像数据随智能体数据一起导入导出
- **智能体记忆功能**：
  - 为每个智能体添加长期记忆内容
  - 记忆内容会在每次对话开始时自动作为上下文提供给AI
  - 支持手动编辑记忆内容
  - 支持AI自动总结对话并生成记忆
  - 记忆状态实时显示
  - 记忆内容随智能体数据一起导入导出

### 对话系统
- 多智能体独立对话历史
- 流式输出模式
- 推荐回复功能
- 消息编辑与复制
- 令牌数与思考时间显示
- 重新生成功能
- 智能滚动
- 智能体记忆自动注入，提供上下文信息
- 对话总结功能，自动生成记忆内容

### 图像生成
- 集成Stable Diffusion WebUI
- 基于对话内容的AI提示词生成
- 图像生成与展示
- 参数配置（采样步数、CFG Scale、尺寸等）
- 模型选择
- 生成进度显示

### 音乐播放器
- 集成网易云音乐API
- 支持音乐搜索（歌曲、歌手、专辑、歌单等）
- 播放列表管理与拖拽排序
- 播放控制（播放/暂停、上一首、下一首、音量控制）
- 播放进度控制与拖动定位
- 歌曲信息显示（专辑封面、歌手、专辑名等）
- 多种播放模式（顺序、随机、单曲循环）
- 用户登录功能（二维码、手机验证码）
- 歌单详情与歌手详情查看
- 智能颜色提取：从音乐封面自动提取主题色
- 最小化播放器：可拖拽的悬浮窗模式
- 播放列表自动导航到当前播放歌曲
- **沉浸式播放器**：
  - 全屏沉浸式音乐播放界面，左侧显示专辑封面和歌曲信息
  - 右侧显示滚动歌词，支持Apple Music风格的歌词展示
  - 动态Canvas背景，从专辑封面提取颜色并创建自然混合效果
  - 支持歌词显示/隐藏翻译，译文与原歌词时间精确对齐
  - 歌词行高度自适应，有译文时自动增加行高
  - 点击歌词可直接跳转到对应时间点
  - 非活跃歌词行模糊效果，突出当前播放歌词
  - 快-慢曲线动画，提供流畅的滚动体验
- **右键菜单功能**：
  - 用户歌单右键菜单：编辑歌单、删除歌单
  - 所有歌曲右键菜单：收藏歌曲、添加到播放列表、添加到指定歌单
  - 支持在子菜单中直接选择歌单添加歌曲，无需打开额外弹窗
  - 覆盖所有歌曲显示区域：主页推荐、搜索结果、歌手详情、歌单详情、专辑详情
  - 智能定位：自动调整菜单位置避免超出视窗边界
- **音乐收藏功能**：
  - 收藏/取消收藏歌曲，支持一键收藏操作
  - 收藏状态实时同步，心形图标动态显示
  - 搜索结果中直接收藏，无需打开播放页面
  - 用户登录后自动加载个人收藏列表
- **歌单管理功能**：
  - 创建、编辑、删除个人歌单
  - 收藏/取消收藏他人歌单
  - 歌单信息自定义（名称、描述）
  - 权限控制：仅创建者可编辑和删除自己的歌单
  - 优雅的弹窗式操作界面
- **音乐主页**：个性化推荐内容展示
  - 推荐歌单与推荐歌曲展示
  - 用户歌单快速访问
  - 底部迷你播放控件，支持基础播放控制和进度显示
  - 歌手信息点击跳转详情页面
  - 短期缓存机制（5分钟），保证推荐内容时效性
- **右键菜单功能**：
  - 用户歌单右键菜单：支持编辑歌单、删除歌单操作
  - 歌曲右键菜单：支持收藏/取消收藏、添加到播放列表
  - 添加到歌单功能：通过子菜单直接选择目标歌单，无需打开额外弹窗
  - 支持所有歌曲区域的右键操作：主页推荐、搜索结果、歌手/歌单/专辑详情
  - 自动定位调整，确保菜单不超出视窗边界

### 悬浮球工具
- 可拖拽的悬浮球界面
- 快速访问音乐播放器、草稿纸、快速对话等功能
- 移动端优化的触摸交互
- 自定义位置记忆
- 快速切换智能体功能
- 右键菜单快速访问智能体记忆和管理功能

### 样式与主题
- 亮/暗主题切换
- 样式定制（主色调、字体大小、圆角等）
- 多种动画效果与动画演示
- 多种消息气泡样式与聊天布局
- 颜色模式选择
- 流光效果（可调节透明度和速度）
- 灵动岛设计
- 弹窗背景模糊和暗化效果
- 字体检测与自定义字体选择
- 音乐封面颜色自适应主题
- 侧边栏按钮网格布局（2x2）

### 数据管理
- 数据导入导出功能
- 自动清理机制
- 手动清理功能
- 存储优化

## 配置说明

### AI API配置
在应用中配置所需的AI服务API密钥和端点。

### Stable Diffusion配置
本地运行Stable Diffusion WebUI，应用将通过代理访问 `http://127.0.0.1:7860`。

### 音乐API配置
1. 需要运行网易云音乐API后端服务
2. 在应用设置中配置音乐API服务器地址
3. 默认使用 `https://zm.i9mr.com` 作为API端点

## 文件结构

```
.
├── index.html              # 应用入口HTML文件
├── package.json            # 项目配置和依赖
├── package-lock.json       # 锁定依赖版本
├── vite.config.js          # Vite构建配置
├── README.md              # 项目说明文档
├── IFLOW.md               # 项目开发指南文档
├── api.md                 # 网易云音乐API文档
├── dist/                  # 构建输出目录
├── node_modules/          # 依赖模块目录
├── public/                # 静态资源
│   └── favicon.ico
└── src/                   # 源代码目录
    ├── main.js            # Vue应用入口
    ├── App.vue            # 主应用组件
    ├── storage.js         # 本地存储管理模块
    ├── indexedDB.js       # IndexedDB 数据库管理模块
    ├── aiService.js       # AI模型服务兼容层
    ├── components/        # 可复用组件
    │   ├── AgentMemory.vue         # 智能体记忆管理组件
    │   ├── AnimationDemo.vue      # 动画效果演示组件
    │   ├── AvatarUpload.vue       # 头像上传组件
    │   ├── CustomCheckbox.vue     # 自定义复选框组件
    │   ├── CustomSelect.vue       # 自定义下拉选择组件
    │   ├── CustomSlider.vue       # 自定义滑块组件
    │   ├── FloatingBall.vue       # 浮动球组件
    │   ├── Modal.vue              # 模态框组件
    │   ├── MusicLogin.vue         # 网易云音乐登录组件
    │   ├── MusicPlayer.vue        # 音乐播放器组件
    │   └── StyleSettings.vue      # 样式设置组件
    ├── styles/            # CSS样式文件
    │   ├── animations.css
    │   ├── base.css
    │   ├── components.css
    │   ├── global.css
    │   └── variables.css
    └── utils/             # 工具类
        ├── fontDetector.js        # 字体检测工具
        ├── markdownParser.js      # Markdown解析器
        ├── musicApiRequestManager.js # 音乐API请求管理工具
        ├── musicColorExtractor.js # 音乐封面颜色提取工具
        └── theme.js               # 主题管理工具
```

## 开发约定

- 使用Vue 3 Composition API风格
- CSS类名使用BEM命名约定
- JavaScript使用ES6+特性
- 组件和文件命名使用PascalCase或kebab-case
- 严格遵循Vue 3最佳实践
- 使用 IndexedDB + localStorage 进行数据持久化（自动降级）
- 所有异步操作使用 async/await 模式
- 确保代码在各种浏览器环境中的兼容性

## 最新更新

### v2.7.0 新增功能
- 💾 **存储系统全面升级**：
  - 聊天历史和图片数据迁移到 IndexedDB 存储，支持更大的存储空间
  - 实现 localStorage 自动降级机制，确保最大兼容性
  - 当浏览器不支持或 IndexedDB 初始化失败时，自动切换到 localStorage
  - 优化数据清理逻辑，删除智能体时同时清理相关对话和图片数据
  - 支持隐私模式和旧版浏览器环境
- 🎨 **草稿纸工具界面优化**：
  - 重写草稿纸工具界面，采用弱化 header 设计
  - 工具栏更加简洁，与项目整体风格统一
  - 优化按钮、颜色选择器和滑块的样式
  - 更新橡皮擦图标，更加直观
- 🐛 **Bug 修复**：
  - 修复 notification 调用中使用了不存在的 'error' 类型的问题
  - 修复 musicApiRequestManager.js 中 cache 初始化位置错误的问题
  - 修复删除智能体时未清理相关对话记录的问题

### v2.6.0 新增功能
- 🧠 **智能体记忆系统优化**：
  - 修复智能体记忆注入逻辑，确保每次对话都能正确获取记忆上下文
  - 添加详细的调试输出，方便追踪记忆注入过程
  - 优化记忆检查机制，避免重复注入
  - 记忆内容现在会在对话历史为空时自动作为系统消息注入
- 🎨 **界面布局优化**：
  - 将样式设置和 AI 设置按钮从 dynamic-island 移动到 sidebar
  - 侧边栏底部按钮整合为 2x2 网格布局
  - 统一所有按钮样式，视觉更加协调
  - 收起侧边栏时自动隐藏按钮区域
- 🔧 **代码质量提升**：
  - 清理冗余样式定义，使用全局样式
  - 优化按钮组件结构，提升可维护性

### v2.5.0 新增功能
- 🎵 **沉浸式播放器全新体验**：
  - 全屏沉浸式音乐播放界面，左侧专辑封面与右侧歌词的优雅布局
  - 动态Canvas背景系统，从专辑封面智能提取颜色并创建自然混合效果
  - 多层渐变与噪声纹理，实现更加随机和自然的背景视觉效果
  - 背景颜色实时响应音乐变化，打造动态视觉体验
- 🎤 **Apple Music风格歌词系统**：
  - 优雅的滚动歌词展示，支持从下往上的流畅滚动效果
  - 智能歌词解析，保留所有有时间标签的行（包括空行）
  - 歌词译文与原歌词精确时间对齐，支持近似匹配算法
  - 译文显示优化，独立样式设计，不会遮挡原歌词
  - 点击歌词可直接跳转到对应播放时间点
- 🎨 **视觉效果全面升级**：
  - 非活跃歌词行模糊效果，突出当前播放歌词
  - 快-慢曲线动画（cubic-bezier），提供流畅的滚动体验
  - 歌词行高度自适应，有译文时自动增加行高
  - 活跃歌词行使用更细字体和更淡阴影，视觉更柔和
  - 歌词行宽度增加，在一行内塞入更多文本内容
- 🔧 **交互体验优化**：
  - 歌词控制按钮位置优化，更贴近歌曲信息
  - 空行特殊样式，使用音乐符号和斜体显示
  - 近似匹配译文视觉标识，左边框和透明度区分
  - 完整的歌词滚动计算系统，考虑译文高度的动态调整

### v2.4.0 新增功能
- 🖱️ **右键菜单系统全面升级**：
  - 新增用户歌单右键菜单，支持快速编辑和删除操作
  - 实现歌曲全局右键菜单，覆盖所有歌曲显示区域
  - 优化添加到歌单功能，通过子菜单直接选择目标歌单
  - 智能定位系统，自动调整菜单位置避免超出视窗
  - 支持主页推荐、搜索结果、歌手/歌单/专辑详情页面的所有歌曲
  - 点击页面其他位置自动关闭菜单，提升用户体验
- 🎯 **操作流程优化**：
  - 删除添加到歌单弹窗，简化操作步骤
  - 歌单子菜单显示歌曲数量，便于用户快速识别
  - 实时反馈操作结果，成功/失败提示清晰明了
  - 保持数据同步，歌单歌曲数量实时更新
- 🔧 **技术优化**：
  - 修复收藏歌曲Set类型错误，确保数据一致性
  - 优化事件处理机制，防止菜单意外关闭
  - 改进方法命名，提升代码可读性和维护性

### v2.4.0 新增功能
- 🖱️ **右键菜单功能全面升级**：
  - 用户歌单右键菜单：支持编辑歌单、删除歌单操作
  - 所有歌曲右键菜单：收藏/取消收藏歌曲、添加到播放列表
  - 添加到歌单功能：通过子菜单直接选择目标歌单，无需打开额外弹窗
  - 覆盖所有歌曲区域：主页推荐、搜索结果、歌手/歌单/专辑详情、播放列表
  - 智能定位：自动调整菜单位置避免超出视窗边界
  - 点击其他位置自动关闭菜单，提升用户体验
- 🎨 **UI/UX优化**：
  - 右键菜单采用现代化设计，支持暗色主题
  - 子菜单显示歌单封面和歌曲数量，信息展示更直观
  - 添加操作反馈，成功/失败提示信息更清晰
- 🔧 **功能完善**：
  - 修复右键菜单事件冒泡问题
  - 优化菜单显示逻辑，确保菜单始终可见
  - 改进歌曲收藏状态管理，确保数据同步

### v2.3.0 新增功能
- 🎵 **音乐收藏与歌单管理功能**：
  - 新增歌曲收藏功能，支持一键收藏/取消收藏
  - 实现歌单创建、编辑、删除完整管理流程
  - 支持收藏/取消收藏他人歌单
  - 搜索结果中直接收藏歌曲，提升操作效率
  - 收藏状态实时同步，心形图标动态显示
- 🎨 **UI/UX全面优化**：
  - 优化歌单创建/编辑弹窗设计，采用现代化玻璃态效果
  - 改进侧边栏头部样式，增强视觉层次感
  - 修复歌单标题超出容器问题，优化文本显示
  - 简化hover动画，仅保留颜色变化效果
  - 统一设计语言，使用圆角和渐变元素
- 🔧 **交互体验提升**：
  - 优化歌单项布局，确保hover状态下的视觉稳定性
  - 改进按钮反馈效果，增强用户操作感知
  - 完善权限控制，确保用户只能管理自己的歌单
  - 优化加载状态显示，提供更友好的等待体验

### v2.2.0 新增功能
- 🎵 **音乐主页功能全面升级**：
  - 新增个性化推荐内容展示，包括推荐歌单和推荐歌曲
  - 实现底部迷你播放控件，支持基础播放控制和进度显示
  - 推荐歌曲采用紧凑列表设计，优化空间利用
  - 歌手信息支持点击跳转，快速访问歌手详情页面
  - 实现短期缓存机制（5分钟），保证推荐内容时效性
- 🎨 **UI/UX优化**：
  - 优化主页字体颜色显示，提升可读性
  - 改进播放控件时长显示逻辑，确保准确性
  - 底部播放控件支持无歌曲时显示，提供完整体验
- 🔧 **功能完善**：
  - 修复推荐歌曲播放逻辑，与搜索结果保持一致
  - 添加推荐歌曲快速添加到播放列表功能
  - 优化用户信息刷新机制，自动更新主页推荐内容

### v2.1.0 新增功能
- 🎵 **音乐播放器全面升级**：
  - 新增最小化播放器功能，支持可拖拽悬浮窗
  - 添加播放列表自动导航到当前播放歌曲
  - 优化拖拽动画，增加流畅的滞后效果
  - 智能播放列表菜单位置，自适应展开方向
  - 完善播放模式切换与播放列表管理
- 🎨 **样式系统增强**：
  - 新增字体检测工具，支持系统字体选择
  - 音乐封面颜色自动提取与应用
  - 优化加载动画，统一主题颜色
  - 新增动画效果演示组件
- 🔧 **交互体验优化**：
  - 改进tooltip显示位置与动画
  - 修复播放顺序切换按钮功能
  - 优化进度条显示与交互
  - 增强移动端触摸体验

### v2.0.0 核心功能
- 🎵 音乐播放器功能，集成网易云音乐API
- 🎯 悬浮球工具，提供快速访问入口
- 🎨 弹窗背景模糊和暗化效果设置
- 📱 移动端触摸交互体验优化
- 🔧 滑块组件浮点数精度修复
- 💫 流光效果控制，支持透明度调节

## 注意事项

- 项目为纯前端应用，所有数据存储在浏览器中
- 使用网络API需要用户自行配置端点和密钥
- Stable Diffusion图像生成功能需要本地运行SD WebUI
- 音乐播放器功能需要配置并运行网易云音乐API后端服务
- 项目依赖现代浏览器特性，建议使用最新版Chrome/Firefox/Edge
- 图像生成功能依赖SD WebUI的本地部署，需要正确配置代理
- 长对话可能会影响性能，建议适时清理对话历史
- 弹窗背景模糊效果需要浏览器支持 `backdrop-filter` CSS属性

### 数据存储说明

- **对话历史和图片数据**：优先使用 IndexedDB 存储，当浏览器不支持或初始化失败时自动降级到 localStorage
- **智能体信息**：存储在 localStorage 中
- **应用设置**：存储在 localStorage 中
- **智能体记忆**：存储在 localStorage 中
- **数据导入导出**：支持将所有数据导出为 JSON 文件，或从 JSON 文件导入

### 存储兼容性

- IndexedDB 支持更大的存储空间（通常数百MB到数GB），适合存储大量对话和图片数据
- localStorage 存储空间较小（通常5-10MB），在降级模式下建议定期清理对话历史
- 在隐私模式下，IndexedDB 可能不可用，应用会自动使用 localStorage
- 应用会自动检测存储方式并在控制台显示提示信息
